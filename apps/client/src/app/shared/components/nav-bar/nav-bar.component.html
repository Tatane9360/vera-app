<!-- Skip to main content link for keyboard users -->
<a
  href="#main-content"
  class="sr-only focus:not-sr-only focus:absolute focus:top-4 focus:left-4 focus:z-[100] focus:bg-primary focus:text-vera-cream focus:px-4 focus:py-2 focus:rounded-md focus:font-medium"
>
  Aller au contenu principal
</a>

<!-- ARIA Live Region for screen reader announcements -->
<div role="status" aria-live="polite" aria-atomic="true" class="sr-only">
  {{ ariaLiveMessage() }}
</div>

<nav
  class="fixed top-0 left-0 right-0 z-50 transition-all duration-300"
  aria-label="Navigation principale"
  [ngClass]="{
    'bg-vera-cream/80 dark:bg-primary/80 backdrop-blur-md shadow-sm py-4':
      isScrolled(),
    'bg-transparent py-6': !isScrolled()
  }"
>
  <div class="container mx-auto flex items-center justify-between px-6">
    <!-- Logo -->
    <a
      routerLink="/"
      class="text-primary dark:text-red-600 flex items-center"
      aria-label="Vera - Retour à l'accueil"
      [attr.aria-current]="isCurrentRoute('/') ? 'page' : null"
    >
      <app-icon
        [icon]="themeService.darkMode() ? 'logoVeraWhite' : 'logovera'"
        [width]="99"
        [height]="31"
      >
      </app-icon>
    </a>

    <!-- Desktop Menu -->
    <div
      class="hidden lg:flex items-center gap-10"
      role="navigation"
      aria-label="Menu principal"
    >
      <a
        [routerLink]="['/']"
        fragment="how-it-works"
        [attr.aria-current]="
          isCurrentRoute('/', 'how-it-works') ? 'location' : null
        "
        class="text-base font-medium text-primary dark:text-vera-cream hover:opacity-70 transition-opacity cursor-pointer"
      >
        Comment ça marche ?
      </a>
      <a
        [routerLink]="['/']"
        fragment="sources"
        [attr.aria-current]="isCurrentRoute('/', 'sources') ? 'location' : null"
        class="text-base font-medium text-primary dark:text-vera-cream hover:opacity-70 transition-opacity cursor-pointer"
      >
        Nos Sources
      </a>
    </div>

    <!-- Right Actions -->
    <div class="flex items-center gap-6">
      <!-- Desktop Auth & Theme - Hidden on Mobile -->
      <div class="hidden lg:flex items-center gap-6">
        <ng-container *ngIf="isAuthenticated">
          <a
            routerLink="/flo_le_meilleur_prof"
            [attr.aria-current]="
              isCurrentRoute('/flo_le_meilleur_prof') ? 'page' : null
            "
            class="text-sm font-medium text-primary dark:text-vera-cream hover:opacity-70"
          >
            Dashboard
          </a>
          <button
            (click)="logout()"
            class="text-sm font-medium text-red-600 hover:opacity-70"
            aria-label="Se déconnecter de votre compte"
          >
            Déconnexion
          </button>
        </ng-container>

        <a
          routerLink="/fact-checking"
          [attr.aria-current]="isCurrentRoute('/fact-checking') ? 'page' : null"
          class="bg-primary text-vera-cream dark:bg-vera-cream dark:text-primary font-medium py-3 px-8 rounded-full text-sm hover:opacity-90 transition-opacity"
        >
          Parler à Vera
        </a>

        <!-- Theme Toggle -->
        <div
          class="flex items-center gap-3 text-sm font-medium text-primary dark:text-vera-cream"
          role="group"
          aria-label="Sélection du thème"
        >
          <button
            (click)="toggleTheme(false)"
            [class.underline]="!themeService.darkMode()"
            [class.opacity-50]="themeService.darkMode()"
            [attr.aria-pressed]="!themeService.darkMode()"
            aria-label="Activer le thème clair"
            class="decoration-1 underline-offset-4 hover:opacity-100 transition-opacity"
          >
            Light
          </button>
          <button
            (click)="toggleTheme(true)"
            [class.underline]="themeService.darkMode()"
            [class.opacity-50]="!themeService.darkMode()"
            [attr.aria-pressed]="themeService.darkMode()"
            aria-label="Activer le thème sombre"
            class="decoration-1 underline-offset-4 hover:opacity-100 transition-opacity"
          >
            Dark
          </button>
        </div>
      </div>

      <!-- Mobile Toggle -->
      <button
        #mobileMenuToggle
        (click)="toggleMobileMenu()"
        class="lg:hidden relative z-50 p-2 text-primary dark:text-vera-cream hover:opacity-70 transition-opacity"
        [attr.aria-expanded]="isMobileMenuOpen()"
        aria-controls="mobile-menu"
        aria-label="Ouvrir le menu de navigation"
      >
        <span class="material-icons-outlined text-2xl" aria-hidden="true">{{
          isMobileMenuOpen() ? 'close' : 'menu'
        }}</span>
      </button>
    </div>
  </div>
</nav>

<!-- Mobile Menu Overlay -->
<div
  #mobileMenuOverlay
  id="mobile-menu"
  role="dialog"
  aria-modal="true"
  aria-label="Menu de navigation mobile"
  [attr.aria-hidden]="!isMobileMenuOpen()"
  class="fixed inset-0 z-40 bg-vera-cream dark:bg-primary transition-all duration-700 ease-in-out lg:hidden flex flex-col items-center justify-center"
  [style.clip-path]="
    isMobileMenuOpen() ? 'circle(150% at top right)' : 'circle(0% at top right)'
  "
  [style.pointer-events]="isMobileMenuOpen() ? 'auto' : 'none'"
>
  <nav
    class="flex flex-col items-center gap-8 text-center"
    aria-label="Menu mobile"
  >
    <a
      [routerLink]="['/']"
      fragment="home"
      (click)="closeMobileMenu()"
      [attr.aria-current]="isCurrentRoute('/', 'home') ? 'location' : null"
      class="text-3xl font-display font-bold text-primary dark:text-vera-cream hover:opacity-70 transition-opacity"
    >
      Accueil
    </a>
    <a
      [routerLink]="['/']"
      fragment="how-it-works"
      (click)="closeMobileMenu()"
      [attr.aria-current]="
        isCurrentRoute('/', 'how-it-works') ? 'location' : null
      "
      class="text-3xl font-display font-bold text-primary dark:text-vera-cream hover:opacity-70 transition-opacity"
    >
      Comment ça marche ?
    </a>
    <a
      [routerLink]="['/']"
      fragment="sources"
      (click)="closeMobileMenu()"
      [attr.aria-current]="isCurrentRoute('/', 'sources') ? 'location' : null"
      class="text-3xl font-display font-bold text-primary dark:text-vera-cream hover:opacity-70 transition-opacity"
    >
      Nos Sources
    </a>

    <div
      class="w-12 h-1 bg-primary/10 dark:bg-vera-cream/10 rounded-full my-4"
      aria-hidden="true"
    ></div>

    <ng-container *ngIf="isAuthenticated">
      <a
        routerLink="/flo_le_meilleur_prof"
        (click)="closeMobileMenu()"
        [attr.aria-current]="
          isCurrentRoute('/flo_le_meilleur_prof') ? 'page' : null
        "
        class="text-xl font-medium text-primary dark:text-vera-cream hover:opacity-70"
      >
        Dashboard
      </a>
      <button
        (click)="logout(); closeMobileMenu()"
        class="text-xl font-medium text-red-600 hover:opacity-70"
        aria-label="Se déconnecter de votre compte"
      >
        Déconnexion
      </button>
    </ng-container>

    <a
      routerLink="/fact-checking"
      (click)="closeMobileMenu()"
      [attr.aria-current]="isCurrentRoute('/fact-checking') ? 'page' : null"
      class="mt-4 bg-primary text-vera-cream dark:bg-vera-cream dark:text-primary font-medium py-4 px-10 rounded-full text-lg hover:opacity-90 transition-opacity"
    >
      Parler à Vera
    </a>

    <!-- Mobile Theme Toggle -->
    <div
      class="flex items-center gap-6 mt-8"
      role="group"
      aria-label="Sélection du thème"
    >
      <button
        (click)="toggleTheme(false)"
        [class.opacity-50]="themeService.darkMode()"
        [attr.aria-pressed]="!themeService.darkMode()"
        aria-label="Activer le thème clair"
        class="flex flex-col items-center gap-2 text-primary dark:text-vera-cream transition-opacity"
      >
        <span class="material-icons-outlined text-2xl" aria-hidden="true"
          >light_mode</span
        >
        <span class="text-sm font-medium">Light</span>
      </button>
      <div
        class="w-px h-8 bg-primary/20 dark:bg-vera-cream/20"
        aria-hidden="true"
      ></div>
      <button
        (click)="toggleTheme(true)"
        [class.opacity-50]="!themeService.darkMode()"
        [attr.aria-pressed]="themeService.darkMode()"
        aria-label="Activer le thème sombre"
        class="flex flex-col items-center gap-2 text-primary dark:text-vera-cream transition-opacity"
      >
        <span class="material-icons-outlined text-2xl" aria-hidden="true"
          >dark_mode</span
        >
        <span class="text-sm font-medium">Dark</span>
      </button>
    </div>
  </nav>
</div>
