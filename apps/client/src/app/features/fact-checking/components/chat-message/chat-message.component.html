<!-- User Message -->
<div *ngIf="message().role === 'user'" class="flex justify-end">
  <div class="max-w-[85%] md:max-w-[70%]">
    <div
      class="bg-primary text-vera-cream rounded-2xl rounded-tr-sm px-6 py-4 shadow-md"
    >
      <!-- Text/URL Content -->
      <p
        *ngIf="message().type !== 'image'"
        class="whitespace-pre-wrap break-words text-lg font-medium"
      >
        {{ message().content }}
      </p>

      <!-- Image Preview -->
      <div *ngIf="message().type === 'image'" class="space-y-2">
        <img
          [src]="message().imagePreview"
          class="max-h-64 rounded-lg border border-white/10"
          alt="Uploaded image"
        />
        <p class="text-xs text-vera-cream/70">{{ message().content }}</p>
      </div>
    </div>
  </div>
</div>

<!-- Vera Message -->
<div *ngIf="message().role === 'vera'" class="flex justify-start">
  <div class="max-w-[90%] md:max-w-[75%]">
    <div
      class="bg-white dark:bg-gray-800 text-primary dark:text-vera-cream rounded-2xl rounded-tl-sm px-6 py-5 shadow-md relative border border-gray-100 dark:border-gray-700 group"
    >
      <!-- Share Button -->
      <button
        *ngIf="!message().isLoading"
        (click)="shareMessage()"
        class="absolute top-2 right-2 p-2 text-gray-400 hover:text-primary dark:hover:text-white transition-colors rounded-full hover:bg-gray-100 dark:hover:bg-gray-700"
        [title]="copied() ? 'CopiÃ© !' : 'Partager'"
      >
        <svg
          xmlns="http://www.w3.org/2000/svg"
          width="24"
          height="24"
          viewBox="0 0 24 24"
        >
          <path
            fill="currentColor"
            d="M17 22q-1.25 0-2.125-.875T14 19q0-.15.075-.7L7.05 14.2q-.4.375-.925.588T5 15q-1.25 0-2.125-.875T2 12t.875-2.125T5 9q.6 0 1.125.213t.925.587l7.025-4.1q-.05-.175-.062-.337T14 5q0-1.25.875-2.125T17 2t2.125.875T20 5t-.875 2.125T17 8q-.6 0-1.125-.213T14.95 7.2l-7.025 4.1q.05.175.063.338T8 12t-.012.363t-.063.337l7.025 4.1q.4-.375.925-.587T17 16q1.25 0 2.125.875T20 19t-.875 2.125T17 22"
          />
        </svg>
      </button>

      <!-- Loading State -->
      <div *ngIf="message().isLoading" class="flex items-center gap-2">
        <div
          class="w-2 h-2 bg-primary dark:bg-vera-cream rounded-full animate-bounce"
        ></div>
        <div
          class="w-2 h-2 bg-primary dark:bg-vera-cream rounded-full animate-bounce delay-100"
        ></div>
        <div
          class="w-2 h-2 bg-primary dark:bg-vera-cream rounded-full animate-bounce delay-200"
        ></div>
      </div>

      <!-- Content -->
      <div *ngIf="!message().isLoading">
        <p class="whitespace-pre-wrap leading-relaxed text-lg pr-8">
          {{ message().content }}
        </p>

        <!-- Links Cards -->
        <app-source-links [links]="message().links || []"></app-source-links>
      </div>
    </div>
  </div>
</div>
